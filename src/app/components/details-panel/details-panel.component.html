<!-- Details Panel — Slide-in Side Panel -->
<div class="panel" @slideIn (click)="onPanelClick()">
  <!-- ── Header ────────────────────────────────────────────────────────── -->
  <div class="panel__header">
    <div class="panel__header-text">
      <h2 class="panel__title">{{ panelTitle() }}</h2>
      <p class="panel__subtitle">Specify the dates, name and status for this order</p>
    </div>
    <div class="panel__header-actions">
      <button class="panel__btn panel__btn--cancel" (click)="onCancel()">Cancel</button>
      <button class="panel__btn panel__btn--create" (click)="onSave()">{{ actionLabel() }}</button>
    </div>
  </div>

  <div class="panel__divider"></div>

  <!-- ── Form ──────────────────────────────────────────────────────────── -->
  <div class="panel__form">
    <!-- Work Order Name -->
    <div class="panel__field">
      <label class="panel__label">Work Order Name</label>
      <input
        class="panel__input"
        type="text"
        [formControl]="$any(form.get('name'))"
        placeholder="Enter work order name"
      />
    </div>

    <!-- Status -->
    <div class="panel__field">
      <label class="panel__label">Status</label>
      <div class="panel__status-selector">
        <div class="panel__input panel__input--status" (click)="toggleStatusDropdown($event)">
          <span class="panel__status-pill" [class]="selectedStatusClass()">
            {{ form.get('status')?.value }}
          </span>
          <svg
            class="panel__status-caret"
            [class.panel__status-caret--open]="statusDropdownOpen()"
            width="10"
            height="6"
            viewBox="0 0 10 6"
            fill="none"
          >
            <path
              d="M1 1L5 5L9 1"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>

        @if (statusDropdownOpen()) {
          <div class="panel__status-dropdown">
            @for (status of statusOptions; track status) {
              <button
                class="panel__status-option"
                [class.panel__status-option--active]="form.get('status')?.value === status"
                (click)="selectStatus(status)"
              >
                {{ status }}
              </button>
            }
          </div>
        }
      </div>
    </div>

    <!-- End Date -->
    <div class="panel__field">
      <label class="panel__label">End date</label>
      <div class="panel__date-wrapper">
        <div class="panel__input panel__input--date" (click)="toggleDatepicker('end', $event)">
          <span [class.panel__date-placeholder]="!getDateDisplay('endDate')">
            {{ getDateDisplay('endDate') || 'Select date' }}
          </span>
        </div>

        @if (openDatepicker() === 'end') {
          <div class="panel__datepicker-dropdown" (click)="$event.stopPropagation()">
            <ngb-datepicker
              [startDate]="getDatepickerModel('endDate') || { year: 2026, month: 1 }"
              [minDate]="{ year: 2020, month: 1, day: 1 }"
              [maxDate]="{ year: 2035, month: 12, day: 31 }"
              (dateSelect)="onDateSelect('endDate', $event)"
              [dayTemplate]="dayTpl"
              [navigation]="'select'"
              outsideDays="visible"
            />
          </div>
        }
      </div>
    </div>

    <!-- Start Date -->
    <div class="panel__field">
      <label class="panel__label">Start date</label>
      <div class="panel__date-wrapper">
        <div class="panel__input panel__input--date" (click)="toggleDatepicker('start', $event)">
          <span [class.panel__date-placeholder]="!getDateDisplay('startDate')">
            {{ getDateDisplay('startDate') || 'Select date' }}
          </span>
        </div>

        @if (openDatepicker() === 'start') {
          <div class="panel__datepicker-dropdown" (click)="$event.stopPropagation()">
            <ngb-datepicker
              [startDate]="getDatepickerModel('startDate') || { year: 2026, month: 1 }"
              [minDate]="{ year: 2020, month: 1, day: 1 }"
              [maxDate]="{ year: 2035, month: 12, day: 31 }"
              (dateSelect)="onDateSelect('startDate', $event)"
              [dayTemplate]="dayTpl"
              [navigation]="'select'"
              outsideDays="visible"
            />
          </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Day template for ngb-datepicker -->
<ng-template #dayTpl let-date let-focused="focused" let-selected="selected">
  <span
    class="ngb-dp-day-cell"
    [class.ngb-dp-day-cell--selected]="selected"
    [class.ngb-dp-day-cell--focused]="focused"
  >
    {{ date.day }}
  </span>
</ng-template>
